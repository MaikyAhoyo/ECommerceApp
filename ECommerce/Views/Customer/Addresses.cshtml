@model IEnumerable<ECommerce.Models.Entities.ShippingAddress>
@{
    ViewData["Title"] = "My Addresses";
    Layout = "_CustomerLayout";
}

<section class="bg-gradient-to-br from-primary via-primary/95 to-primary/90 py-16 relative overflow-hidden">
    <nav aria-label="breadcrumb" class="mb-6 flex justify-center">
        <ol class="flex items-center space-x-2 text-sm text-white/60">
            <li><a asp-controller="Customer" asp-action="Home" class="hover:text-gold transition-colors">Home</a></li>
            <li><i class="ph ph-caret-right text-xs"></i></li>
            <li class="text-white font-medium truncate max-w-[200px]">My Addresses</li>
        </ol>
    </nav>

    <div class="container mx-auto px-4 relative z-10 text-white text-center">
        <h1 class="font-playfair text-4xl md:text-5xl font-bold mb-4">My Addresses</h1>
        <p class="text-xl text-white/80">Manage your shipping destinations</p>
    </div>
</section>

<div class="bg-cream py-12 pb-24 min-h-[60vh]">
    <div class="container mx-auto px-4">

        <div class="flex justify-end mb-8">
            <a asp-controller="Customer" 
               asp-action="CreateAddress" 
               class="inline-flex items-center px-6 py-3 bg-gold hover:bg-gold-dark text-white rounded-full font-bold shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all duration-300">
                <i class="ph-bold ph-plus mr-2"></i>Add New Address
            </a>
        </div>

        @if (Model != null && Model.Any())
        {
            <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                @foreach (var address in Model)
                {
                    <div class="bg-white rounded-3xl border border-gray-100 p-8 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group relative overflow-hidden">

                        <div class="absolute top-0 right-0 w-24 h-24 bg-gradient-to-br from-gold/10 to-transparent rounded-bl-full -mr-4 -mt-4 transition-opacity"></div>

                        <div class="relative z-10">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-10 h-10 rounded-full bg-cream text-gold flex items-center justify-center shadow-sm">
                                    <i class="ph-fill ph-map-pin text-xl"></i>
                                </div>
                                <h3 class="font-playfair font-bold text-xl text-primary">Shipping Address</h3>
                            </div>

                            <div class="space-y-2 text-gray-600 mb-8 min-h-[100px]">
                                <p class="font-semibold text-gray-800 text-lg">@address.AddressLine1</p>
                                @if (!string.IsNullOrEmpty(address.AddressLine2))
                                {
                                    <p>@address.AddressLine2</p>
                                }
                                <p>@address.City, @address.State @address.PostalCode</p>
                                <p class="uppercase tracking-wide text-xs font-bold text-gray-400">@address.Country</p>
                            </div>

                            <div class="flex gap-3 pt-6 border-t border-gray-100">
                                <a asp-controller="Customer" 
                                   asp-action="EditAddress" 
                                   asp-route-id="@address.Id" 
                                   class="flex-1 inline-flex items-center justify-center px-4 py-2.5 border-2 border-gray-200 text-gray-600 font-semibold rounded-xl hover:border-primary hover:text-primary hover:bg-gray-50 transition-all">
                                    <i class="ph-bold ph-pencil-simple mr-2"></i>Edit
                                </a>

                                <form method="post" 
                                      asp-controller="Customer" 
                                      asp-action="DeleteAddress" 
                                      asp-route-id="@address.Id" class="flex-1 delete-form">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="w-full inline-flex items-center justify-center px-4 py-2.5 bg-red-50 text-red-500 font-semibold rounded-xl hover:bg-red-100 hover:text-red-600 transition-all">
                                        <i class="ph-bold ph-trash mr-2"></i>Delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="bg-white rounded-3xl p-16 text-center border border-dashed border-gray-200 shadow-sm max-w-2xl mx-auto">
                <div class="w-20 h-20 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-6 text-gray-300">
                    <i class="ph-fill ph-map-pin text-4xl"></i>
                </div>
                <h2 class="font-playfair text-3xl font-bold text-primary mb-3">No addresses yet</h2>
                <p class="text-gray-500 mb-8 text-lg">Save your shipping details for a faster checkout experience.</p>
                <a asp-controller="Customer" asp-action="CreateAddress" class="inline-flex items-center px-8 py-4 bg-primary hover:bg-primary/90 text-white rounded-full font-bold shadow-lg hover:shadow-xl transition-all">
                    <i class="ph-bold ph-plus mr-2"></i>Add Your First Address
                </a>
            </div>
        }
    </div>
</div>

<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-40 backdrop-blur-sm hidden items-center justify-center z-[9999]">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full shadow-xl border border-gray-200">
        
        <div class="bg-red-50 border border-red-100 text-red-600 px-6 py-4 rounded-2xl flex items-center gap-3 mb-6">
            <i class="ph-fill ph-warning-circle text-2xl"></i>
            <div>
                <span class="font-bold block">Confirm Delete</span>
                <span class="text-sm">This action cannot be undone.</span>
            </div>
        </div>

        <div class="flex justify-end gap-3 mt-4">
            <button id="cancelDelete" class="px-5 py-2 rounded-xl border border-gray-300 text-gray-700 hover:bg-gray-50 transition">
                Cancel
            </button>
            <button id="confirmDelete" class="px-5 py-2 rounded-xl bg-red-600 text-white hover:bg-red-700 transition">
                Delete
            </button>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("deleteModal");
        const confirmBtn = document.getElementById("confirmDelete");
        const cancelBtn = document.getElementById("cancelDelete");

        let formToSubmit = null;

        document.addEventListener("submit", function (e) {
            const form = e.target;
            if (!form.classList.contains("delete-form")) return;

            e.preventDefault();
            formToSubmit = form;

            modal.classList.remove("hidden");
            modal.classList.add("flex");
        });

        cancelBtn.addEventListener("click", () => {
            modal.classList.add("hidden");
            modal.classList.remove("flex");
            formToSubmit = null;
        });

        confirmBtn.addEventListener("click", () => {
            if (formToSubmit) {
                formToSubmit.submit();
            }
        });

        modal.addEventListener("click", (e) => {
            if (e.target === modal) {
                modal.classList.add("hidden");
                modal.classList.remove("flex");
                formToSubmit = null;
            }
        });
    });
</script>